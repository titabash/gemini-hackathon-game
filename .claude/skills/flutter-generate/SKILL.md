---
name: flutter-generate
description: Run code generation for Freezed, Riverpod, and build_runner packages. Use when generating .g.dart and .freezed.dart files after modifying models or providers.
---

# Flutter Code Generation Skill

Run code generation for Freezed, Riverpod, and other build_runner packages in the Flutter monorepo.

## Task

Execute `build_runner` to generate code for:
- **Freezed**: `.freezed.dart` files for immutable models
- **Riverpod**: `.g.dart` files for providers
- **JSON Serialization**: `.g.dart` files for JSON conversion
- **i18n (Slang)**: Translation files
- **Drift**: Database models (if used)

## Quick Commands

### Generate All Packages

```bash
cd frontend
melos run generate
```

This runs `dart run build_runner build --delete-conflicting-outputs` on all packages that depend on `build_runner`.

### Generate Specific Package

```bash
cd frontend/packages/core/{package_name}
dart run build_runner build --delete-conflicting-outputs
```

### Generate Main App

```bash
cd frontend/apps/web
dart run build_runner build --delete-conflicting-outputs
```

### Watch Mode (Auto-regenerate on file changes)

```bash
cd frontend/apps/web
dart run build_runner watch
```

### Clean Generated Files

```bash
cd frontend
dart run build_runner clean
```

## When to Run Code Generation

Run code generation after:
- ✅ Creating or modifying Freezed models
- ✅ Creating or modifying Riverpod providers
- ✅ Adding `@JsonSerializable()` annotations
- ✅ Updating i18n translation files
- ✅ Modifying Drift database schemas
- ✅ Getting build errors related to generated code

## Complete Workflow

### 1. After Creating/Modifying Code:

```bash
# Option A: Generate all packages (recommended)
cd frontend && melos run generate

# Option B: Generate specific package
cd frontend/packages/core/polar
dart run build_runner build --delete-conflicting-outputs
```

### 2. Verify Generation:

```bash
# Check for generated files
find . -name "*.g.dart" -o -name "*.freezed.dart"

# Check for errors
flutter analyze
```

### 3. Run Quality Checks:

```bash
make check-flutter
```

## Generated File Patterns

### Freezed Models:
```
model_name.dart          # Original file
model_name.freezed.dart  # Generated by Freezed
model_name.g.dart        # Generated by json_serializable (if used)
```

### Riverpod Providers:
```
provider_name.dart       # Original file
provider_name.g.dart     # Generated by riverpod_generator
```

### i18n (Slang):
```
translations/
  en.i18n.json          # Original English
  ja.i18n.json          # Original Japanese
generated/
  strings.g.dart        # Generated translations
  strings_en.g.dart     # Generated English
  strings_ja.g.dart     # Generated Japanese
```

## Troubleshooting

### Build Errors

**Problem**: "Conflicting outputs"
```bash
# Solution: Use --delete-conflicting-outputs
dart run build_runner build --delete-conflicting-outputs
```

**Problem**: "Part file doesn't exist"
```dart
// Solution: Add part directive to source file
part 'file_name.g.dart';
part 'file_name.freezed.dart';
```

**Problem**: "Cannot run build_runner"
```bash
# Solution: Ensure build_runner is in dev_dependencies
cd frontend
flutter pub get
```

### Analyzer Errors After Generation

**Problem**: Undefined class errors for Riverpod Ref types

Add to `analysis_options.yaml`:
```yaml
analyzer:
  errors:
    undefined_class: ignore
```

**Problem**: Freezed inheritance errors

Add to `analysis_options.yaml`:
```yaml
analyzer:
  errors:
    non_abstract_class_inherits_abstract_member: ignore
```

### Performance Issues

**Problem**: Code generation is slow

```bash
# Option 1: Generate only changed files
dart run build_runner build

# Option 2: Use watch mode during development
dart run build_runner watch

# Option 3: Generate specific files
dart run build_runner build --build-filter="lib/models/*.dart"
```

## Best Practices

1. **Always Regenerate After Changes**:
   - Don't commit code without running generation
   - Use watch mode during active development
   - Run full generation before commits

2. **Use Melos for Monorepo**:
   - `melos run generate` handles all packages
   - Faster than generating each package individually
   - Ensures consistency across packages

3. **Check Generated Files**:
   - Review generated code for correctness
   - Don't modify generated files manually
   - Generated files should be committed to git

4. **Clean When Needed**:
   - Run `clean` if you encounter strange errors
   - Clean before major refactors
   - Clean after changing dependencies

5. **Exclude from Formatting**:
   - Generated files are automatically excluded
   - `*.g.dart` and `*.freezed.dart` patterns
   - Configured in `analysis_options.yaml`

## Integration with Make Commands

The project includes Make commands that automatically run generation:

```bash
# Bootstrap and generate all packages
make frontend

# Quality check (includes generation)
make check-flutter

# Test all packages (includes generation)
make frontend-test
```

## Watch Mode for Development

Start watch mode for auto-regeneration:

```bash
# Terminal 1: Watch mode for code generation
cd frontend/apps/web
dart run build_runner watch

# Terminal 2: Run Flutter app
make frontend
```

This automatically regenerates code when files change.

## Notes

- Code generation is a critical step in the development workflow
- Always run generation before committing code
- Generated files are version-controlled (not in .gitignore)
- See CLAUDE.md for complete development workflow
- Use `make check-flutter` to verify everything is correct
