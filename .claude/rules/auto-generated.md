# Auto-Generated Files Policy

**CRITICAL**: The following files are AUTO-GENERATED. NEVER manually edit these files.

## Auto-Generated Files List

| File/Directory | Generated By | Command |
|----------------|--------------|---------|
| `**/*.g.dart` | build_runner (Riverpod, json_serializable) | `make frontend-generate` |
| `**/*.freezed.dart` | build_runner (Freezed) | `make frontend-generate` |
| `**/*.gr.dart` | build_runner (auto_route, if used) | `make frontend-generate` |
| `frontend/packages/core/i18n/lib/generated/` | slang | `make frontend-generate` |
| `supabase/functions/shared/types/supabase/schema.ts` | Supabase CLI | `make build-model-functions` |
| `supabase/functions/shared/drizzle/` | Copy from `drizzle/schema/` | `make build-model-functions` |
| `backend-py/app/src/domain/entity/models.py` | sqlacodegen | Docker container startup |

## Generation Mechanism

### Flutter Code Generation (build_runner)

Generated via `flutter pub run build_runner build`:

```bash
make frontend-generate               # Generate all Flutter code
# Or directly in specific package:
cd frontend/apps/web && flutter pub run build_runner build --delete-conflicting-outputs
```

**Generated files:**
- `*.g.dart` - Riverpod providers, json_serializable, Drift
- `*.freezed.dart` - Freezed immutable models
- `*.gr.dart` - auto_route (if used)
- `frontend/packages/core/i18n/lib/generated/` - slang translations

### Edge Functions Types

Generated via `supabase gen types typescript --local`:

```bash
make build-model-functions  # Edge Functions types
make build-model            # All types
```

### Backend Python Models

**Automatically generated on container startup** via `docker-compose.backend.yaml`:

```bash
uv run sqlacodegen "$DIRECT_URL" --generator sqlmodels --options nojoined --outfile src/domain/entity/models.py
```

This runs every time `make run` or `docker-compose up` is executed.

## Prohibited Actions

**NEVER**:
- Manually edit any auto-generated file (`*.g.dart`, `*.freezed.dart`, etc.)
- Add custom code to auto-generated files
- Modify the file structure of auto-generated directories
- Commit local modifications to auto-generated files

```dart
// ❌ WRONG: Editing generated file directly
// user_model.g.dart
Map<String, dynamic> _$UserToJson(User instance) => <String, dynamic>{
  'custom_field': instance.customField,  // DO NOT modify!
};

// ✅ CORRECT: Modify the source file
// user_model.dart
@freezed
class User with _$User {
  const factory User({
    required String id,
    required String name,
    String? customField,  // Add field here
  }) = _User;

  factory User.fromJson(Map<String, dynamic> json) => _$UserFromJson(json);
}
// Then run: make frontend-generate
```

## Correct Workflow

### When you need to change data models:

**For Database Schema:**
1. **Edit Drizzle schema**: `drizzle/schema/*.ts`
2. **Request migration**: Ask user to run `make migrate-dev`
3. **Types auto-regenerate**: `make build-model` is included in `migrate-dev`
4. **Backend models auto-regenerate**: Restart container with `make run`

**For Flutter Models (Freezed):**
1. **Edit source file**: `*/models/*.dart` (with `@freezed` annotation)
2. **Regenerate**: Run `make frontend-generate`
3. **Verify**: Check `*.freezed.dart` and `*.g.dart` files generated

**For Riverpod Providers:**
1. **Edit provider file**: `*/providers/*.dart` (with `@riverpod` annotation)
2. **Regenerate**: Run `make frontend-generate`
3. **Verify**: Check `*.g.dart` file generated

**For Translations (slang):**
1. **Edit JSON files**: `frontend/packages/core/i18n/lib/translations/*.i18n.json`
2. **Regenerate**: Run `make frontend-generate`
3. **Verify**: Check `frontend/packages/core/i18n/lib/generated/` directory

## Common Auto-Generated Patterns

### Riverpod Provider

```dart
// Source file: counter_provider.dart
@riverpod
class Counter extends _$Counter {
  @override
  int build() => 0;

  void increment() => state++;
}

// Generated: counter_provider.g.dart (DO NOT EDIT)
```

### Freezed Model

```dart
// Source file: user.dart
@freezed
class User with _$User {
  const factory User({
    required String id,
    required String name,
  }) = _User;

  factory User.fromJson(Map<String, dynamic> json) => _$UserFromJson(json);
}

// Generated files (DO NOT EDIT):
// - user.freezed.dart (copyWith, ==, toString)
// - user.g.dart (fromJson, toJson)
```

### slang Translations

```json
// Source: en.i18n.json
{
  "hello": "Hello",
  "world": "World"
}

// Generated: strings.g.dart (DO NOT EDIT)
// Access: t.hello, t.world
```

## Why This Policy Exists

- Auto-generated files are **overwritten** on every generation
- Manual changes will be **lost** without warning
- Source of truth is:
  - Database schema: **Drizzle** (`drizzle/schema/`)
  - Flutter models: **Source files with annotations** (`@freezed`, `@riverpod`)
  - Translations: **JSON files** (`*.i18n.json`)
- Ensures **consistency** between source and generated code

## Enforcement

If you see a need to modify auto-generated files, **STOP** and:
1. Identify the correct source file (e.g., `*.dart` with annotations, `*.i18n.json`)
2. Make changes there instead
3. Regenerate using `make frontend-generate` or appropriate command
4. Verify the generated files reflect your changes

**Remember**: Generated files are `.gitignore`d (or should be reviewed carefully before committing). Focus on source files only.
